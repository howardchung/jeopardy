{"ast":null,"code":"import _objectSpread from\"/home/runner/work/jeopardy/jeopardy/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _classCallCheck from\"/home/runner/work/jeopardy/jeopardy/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"/home/runner/work/jeopardy/jeopardy/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"/home/runner/work/jeopardy/jeopardy/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"/home/runner/work/jeopardy/jeopardy/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import React from'react';import{Button,Comment,Icon,Input,Segment}from'semantic-ui-react';import{formatTimestamp,getColorHex,getDefaultPicture}from'../../utils';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var Chat=/*#__PURE__*/function(_React$Component){_inherits(Chat,_React$Component);var _super=_createSuper(Chat);function Chat(){var _this;_classCallCheck(this,Chat);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={chatMsg:'',isNearBottom:true};_this.messagesRef=/*#__PURE__*/React.createRef();_this.updateChatMsg=function(e,data){_this.setState({chatMsg:data.value});};_this.sendChatMsg=function(){if(!_this.state.chatMsg){return;}_this.setState({chatMsg:''});_this.props.socket.emit('CMD:chat',_this.state.chatMsg);};_this.onScroll=function(){_this.setState({isNearBottom:_this.isChatNearBottom()});};_this.isChatNearBottom=function(){return _this.messagesRef.current&&_this.messagesRef.current.scrollHeight-_this.messagesRef.current.scrollTop-_this.messagesRef.current.offsetHeight<100;};_this.scrollToBottom=function(){if(_this.messagesRef.current){_this.messagesRef.current.scrollTop=_this.messagesRef.current.scrollHeight;}};_this.formatMessage=function(cmd,msg){if(cmd==='host'){return/*#__PURE__*/_jsxs(React.Fragment,{children:[\"changed the video to \",/*#__PURE__*/_jsx(\"span\",{style:{textTransform:'initial'},children:_this.props.getMediaDisplayName(msg)})]});}else if(cmd==='seek'){return\"jumped to \".concat(formatTimestamp(msg));}else if(cmd==='play'){return\"started the video at \".concat(formatTimestamp(msg));}else if(cmd==='pause'){return\"paused the video at \".concat(formatTimestamp(msg));}else if(cmd==='judge'){var _JSON$parse=JSON.parse(msg),id=_JSON$parse.id,correct=_JSON$parse.correct,answer=_JSON$parse.answer;return/*#__PURE__*/_jsx(\"span\",{style:{color:correct?'#21ba45':'#db2828'},children:\"ruled \".concat(_this.props.nameMap[id],\" \").concat(correct?'correct':'incorrect',\": \").concat(answer,\" \")});}else if(cmd==='answer'){return\"Correct answer: \".concat(msg);}return cmd;};return _this;}_createClass(Chat,[{key:\"componentDidMount\",value:function componentDidMount(){var _this$messagesRef$cur;this.scrollToBottom();(_this$messagesRef$cur=this.messagesRef.current)===null||_this$messagesRef$cur===void 0?void 0:_this$messagesRef$cur.addEventListener('scroll',this.onScroll);}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(this.props.scrollTimestamp!==prevProps.scrollTimestamp){if(prevProps.scrollTimestamp===0||this.state.isNearBottom){this.scrollToBottom();}}}},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsxs(Segment,{className:this.props.className,inverted:true,style:{display:this.props.hide?'none':'flex',flexDirection:'column',flexGrow:'1',minHeight:0,marginTop:0,marginBottom:0},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"chatContainer\",ref:this.messagesRef,style:{position:'relative'},children:[/*#__PURE__*/_jsx(Comment.Group,{children:this.props.chat.map(function(msg){return/*#__PURE__*/_jsx(ChatMessage,_objectSpread(_objectSpread({},msg),{},{pictureMap:_this2.props.pictureMap,nameMap:_this2.props.nameMap,formatMessage:_this2.formatMessage}),msg.timestamp+msg.id);})}),!this.state.isNearBottom&&/*#__PURE__*/_jsx(Button,{size:\"tiny\",onClick:this.scrollToBottom,style:{position:'sticky',bottom:0,display:'block',margin:'0 auto'},children:\"Jump to bottom\"})]}),/*#__PURE__*/_jsx(Input,{inverted:true,fluid:true,onKeyPress:function onKeyPress(e){return e.key==='Enter'&&_this2.sendChatMsg();},onChange:this.updateChatMsg,value:this.state.chatMsg,icon:/*#__PURE__*/_jsx(Icon,{onClick:this.sendChatMsg,name:\"send\",inverted:true,circular:true,link:true}),placeholder:\"Enter a message...\"})]});}}]);return Chat;}(React.Component);var ChatMessage=function ChatMessage(_ref){var id=_ref.id,picture=_ref.picture,timestamp=_ref.timestamp,cmd=_ref.cmd,msg=_ref.msg,nameMap=_ref.nameMap,pictureMap=_ref.pictureMap,formatMessage=_ref.formatMessage;return/*#__PURE__*/_jsxs(Comment,{children:[/*#__PURE__*/_jsx(Comment.Avatar,{src:pictureMap[id]||getDefaultPicture(nameMap[id],getColorHex(id))}),/*#__PURE__*/_jsxs(Comment.Content,{children:[/*#__PURE__*/_jsx(Comment.Author,{as:\"a\",className:\"light\",children:nameMap[id]||id}),/*#__PURE__*/_jsx(Comment.Metadata,{className:\"dark\",children:/*#__PURE__*/_jsx(\"div\",{children:new Date(timestamp).toLocaleTimeString()})}),/*#__PURE__*/_jsx(Comment.Text,{className:\"light system\",children:cmd&&formatMessage(cmd,msg)}),/*#__PURE__*/_jsx(Comment.Text,{className:\"light\",children:!cmd&&msg})]})]});};","map":{"version":3,"names":["React","Button","Comment","Icon","Input","Segment","formatTimestamp","getColorHex","getDefaultPicture","Chat","state","chatMsg","isNearBottom","messagesRef","createRef","updateChatMsg","e","data","setState","value","sendChatMsg","props","socket","emit","onScroll","isChatNearBottom","current","scrollHeight","scrollTop","offsetHeight","scrollToBottom","formatMessage","cmd","msg","textTransform","getMediaDisplayName","JSON","parse","id","correct","answer","color","nameMap","addEventListener","prevProps","scrollTimestamp","className","display","hide","flexDirection","flexGrow","minHeight","marginTop","marginBottom","position","chat","map","pictureMap","timestamp","bottom","margin","key","Component","ChatMessage","picture","Date","toLocaleTimeString"],"sources":["/home/runner/work/jeopardy/jeopardy/src/components/Chat/Chat.tsx"],"sourcesContent":["import React from 'react';\nimport { Button, Comment, Icon, Input, Segment } from 'semantic-ui-react';\nimport { Socket } from 'socket.io';\n\nimport { formatTimestamp, getColorHex, getDefaultPicture } from '../../utils';\n\ninterface ChatProps {\n  chat: ChatMessage[];\n  nameMap: StringDict;\n  pictureMap: StringDict;\n  socket: Socket;\n  scrollTimestamp: number;\n  className?: string;\n  getMediaDisplayName: Function;\n  hide?: boolean;\n}\n\nexport class Chat extends React.Component<ChatProps> {\n  public state = { chatMsg: '', isNearBottom: true };\n  messagesRef = React.createRef<HTMLDivElement>();\n\n  componentDidMount() {\n    this.scrollToBottom();\n    this.messagesRef.current?.addEventListener('scroll', this.onScroll);\n  }\n\n  componentDidUpdate(prevProps: ChatProps) {\n    if (this.props.scrollTimestamp !== prevProps.scrollTimestamp) {\n      if (prevProps.scrollTimestamp === 0 || this.state.isNearBottom) {\n        this.scrollToBottom();\n      }\n    }\n  }\n\n  updateChatMsg = (e: any, data: { value: string }) => {\n    this.setState({ chatMsg: data.value });\n  };\n\n  sendChatMsg = () => {\n    if (!this.state.chatMsg) {\n      return;\n    }\n    this.setState({ chatMsg: '' });\n    this.props.socket.emit('CMD:chat', this.state.chatMsg);\n  };\n\n  onScroll = () => {\n    this.setState({ isNearBottom: this.isChatNearBottom() });\n  };\n\n  isChatNearBottom = () => {\n    return (\n      this.messagesRef.current &&\n      this.messagesRef.current.scrollHeight -\n        this.messagesRef.current.scrollTop -\n        this.messagesRef.current.offsetHeight <\n        100\n    );\n  };\n\n  scrollToBottom = () => {\n    if (this.messagesRef.current) {\n      this.messagesRef.current.scrollTop =\n        this.messagesRef.current.scrollHeight;\n    }\n  };\n\n  formatMessage = (cmd: string, msg: string): React.ReactNode | string => {\n    if (cmd === 'host') {\n      return (\n        <React.Fragment>\n          {`changed the video to `}\n          <span style={{ textTransform: 'initial' }}>\n            {this.props.getMediaDisplayName(msg)}\n          </span>\n        </React.Fragment>\n      );\n    } else if (cmd === 'seek') {\n      return `jumped to ${formatTimestamp(msg)}`;\n    } else if (cmd === 'play') {\n      return `started the video at ${formatTimestamp(msg)}`;\n    } else if (cmd === 'pause') {\n      return `paused the video at ${formatTimestamp(msg)}`;\n    } else if (cmd === 'judge') {\n      const { id, correct, answer } = JSON.parse(msg);\n      return (\n        <span style={{ color: correct ? '#21ba45' : '#db2828' }}>{`ruled ${\n          this.props.nameMap[id]\n        } ${correct ? 'correct' : 'incorrect'}: ${answer} `}</span>\n      );\n    } else if (cmd === 'answer') {\n      return `Correct answer: ${msg}`;\n    }\n    return cmd;\n  };\n\n  render() {\n    return (\n      <Segment\n        className={this.props.className}\n        inverted\n        style={{\n          display: this.props.hide ? 'none' : 'flex',\n          flexDirection: 'column',\n          flexGrow: '1',\n          minHeight: 0,\n          marginTop: 0,\n          marginBottom: 0,\n        }}\n      >\n        <div\n          className=\"chatContainer\"\n          ref={this.messagesRef}\n          style={{ position: 'relative' }}\n        >\n          <Comment.Group>\n            {this.props.chat.map((msg) => (\n              <ChatMessage\n                key={msg.timestamp + msg.id}\n                {...msg}\n                pictureMap={this.props.pictureMap}\n                nameMap={this.props.nameMap}\n                formatMessage={this.formatMessage}\n              />\n            ))}\n            {/* <div ref={this.messagesEndRef} /> */}\n          </Comment.Group>\n          {!this.state.isNearBottom && (\n            <Button\n              size=\"tiny\"\n              onClick={this.scrollToBottom}\n              style={{\n                position: 'sticky',\n                bottom: 0,\n                display: 'block',\n                margin: '0 auto',\n              }}\n            >\n              Jump to bottom\n            </Button>\n          )}\n        </div>\n        <Input\n          inverted\n          fluid\n          onKeyPress={(e: any) => e.key === 'Enter' && this.sendChatMsg()}\n          onChange={this.updateChatMsg}\n          value={this.state.chatMsg}\n          icon={\n            <Icon\n              onClick={this.sendChatMsg}\n              name=\"send\"\n              inverted\n              circular\n              link\n            />\n          }\n          placeholder=\"Enter a message...\"\n        />\n      </Segment>\n    );\n  }\n}\n\nconst ChatMessage = ({\n  id,\n  picture,\n  timestamp,\n  cmd,\n  msg,\n  nameMap,\n  pictureMap,\n  formatMessage,\n}: any) => {\n  return (\n    <Comment>\n      <Comment.Avatar\n        src={pictureMap[id] || getDefaultPicture(nameMap[id], getColorHex(id))}\n      />\n      <Comment.Content>\n        <Comment.Author as=\"a\" className=\"light\">\n          {nameMap[id] || id}\n        </Comment.Author>\n        <Comment.Metadata className=\"dark\">\n          <div>{new Date(timestamp).toLocaleTimeString()}</div>\n        </Comment.Metadata>\n        <Comment.Text className=\"light system\">\n          {cmd && formatMessage(cmd, msg)}\n        </Comment.Text>\n        <Comment.Text className=\"light\">{!cmd && msg}</Comment.Text>\n      </Comment.Content>\n    </Comment>\n  );\n};\n"],"mappings":"4kBAAA,MAAOA,MAAK,KAAM,OAAO,CACzB,OAASC,MAAM,CAAEC,OAAO,CAAEC,IAAI,CAAEC,KAAK,CAAEC,OAAO,KAAQ,mBAAmB,CAGzE,OAASC,eAAe,CAAEC,WAAW,CAAEC,iBAAiB,KAAQ,aAAa,CAAC,wFAa9E,UAAaC,KAAI,+TACRC,KAAK,CAAG,CAAEC,OAAO,CAAE,EAAE,CAAEC,YAAY,CAAE,IAAK,CAAC,OAClDC,WAAW,cAAGb,KAAK,CAACc,SAAS,EAAkB,OAe/CC,aAAa,CAAG,SAACC,CAAM,CAAEC,IAAuB,CAAK,CACnD,MAAKC,QAAQ,CAAC,CAAEP,OAAO,CAAEM,IAAI,CAACE,KAAM,CAAC,CAAC,CACxC,CAAC,OAEDC,WAAW,CAAG,UAAM,CAClB,GAAI,CAAC,MAAKV,KAAK,CAACC,OAAO,CAAE,CACvB,OACF,CACA,MAAKO,QAAQ,CAAC,CAAEP,OAAO,CAAE,EAAG,CAAC,CAAC,CAC9B,MAAKU,KAAK,CAACC,MAAM,CAACC,IAAI,CAAC,UAAU,CAAE,MAAKb,KAAK,CAACC,OAAO,CAAC,CACxD,CAAC,OAEDa,QAAQ,CAAG,UAAM,CACf,MAAKN,QAAQ,CAAC,CAAEN,YAAY,CAAE,MAAKa,gBAAgB,EAAG,CAAC,CAAC,CAC1D,CAAC,OAEDA,gBAAgB,CAAG,UAAM,CACvB,MACE,OAAKZ,WAAW,CAACa,OAAO,EACxB,MAAKb,WAAW,CAACa,OAAO,CAACC,YAAY,CACnC,MAAKd,WAAW,CAACa,OAAO,CAACE,SAAS,CAClC,MAAKf,WAAW,CAACa,OAAO,CAACG,YAAY,CACrC,GAAG,CAET,CAAC,OAEDC,cAAc,CAAG,UAAM,CACrB,GAAI,MAAKjB,WAAW,CAACa,OAAO,CAAE,CAC5B,MAAKb,WAAW,CAACa,OAAO,CAACE,SAAS,CAChC,MAAKf,WAAW,CAACa,OAAO,CAACC,YAAY,CACzC,CACF,CAAC,OAEDI,aAAa,CAAG,SAACC,GAAW,CAAEC,GAAW,CAA+B,CACtE,GAAID,GAAG,GAAK,MAAM,CAAE,CAClB,mBACE,MAAC,KAAK,CAAC,QAAQ,iDAEb,aAAM,KAAK,CAAE,CAAEE,aAAa,CAAE,SAAU,CAAE,UACvC,MAAKb,KAAK,CAACc,mBAAmB,CAACF,GAAG,CAAC,EAC/B,GACQ,CAErB,CAAC,IAAM,IAAID,GAAG,GAAK,MAAM,CAAE,CACzB,0BAAoB1B,eAAe,CAAC2B,GAAG,CAAC,EAC1C,CAAC,IAAM,IAAID,GAAG,GAAK,MAAM,CAAE,CACzB,qCAA+B1B,eAAe,CAAC2B,GAAG,CAAC,EACrD,CAAC,IAAM,IAAID,GAAG,GAAK,OAAO,CAAE,CAC1B,oCAA8B1B,eAAe,CAAC2B,GAAG,CAAC,EACpD,CAAC,IAAM,IAAID,GAAG,GAAK,OAAO,CAAE,CAC1B,gBAAgCI,IAAI,CAACC,KAAK,CAACJ,GAAG,CAAC,CAAvCK,EAAE,aAAFA,EAAE,CAAEC,OAAO,aAAPA,OAAO,CAAEC,MAAM,aAANA,MAAM,CAC3B,mBACE,aAAM,KAAK,CAAE,CAAEC,KAAK,CAAEF,OAAO,CAAG,SAAS,CAAG,SAAU,CAAE,0BACtD,MAAKlB,KAAK,CAACqB,OAAO,CAACJ,EAAE,CAAC,aACpBC,OAAO,CAAG,SAAS,CAAG,WAAW,cAAKC,MAAM,OAAW,CAE/D,CAAC,IAAM,IAAIR,GAAG,GAAK,QAAQ,CAAE,CAC3B,gCAA0BC,GAAG,EAC/B,CACA,MAAOD,IAAG,CACZ,CAAC,iEAzED,4BAAoB,2BAClB,IAAI,CAACF,cAAc,EAAE,CACrB,2BAAI,CAACjB,WAAW,CAACa,OAAO,gDAAxB,sBAA0BiB,gBAAgB,CAAC,QAAQ,CAAE,IAAI,CAACnB,QAAQ,CAAC,CACrE,CAAC,kCAED,4BAAmBoB,SAAoB,CAAE,CACvC,GAAI,IAAI,CAACvB,KAAK,CAACwB,eAAe,GAAKD,SAAS,CAACC,eAAe,CAAE,CAC5D,GAAID,SAAS,CAACC,eAAe,GAAK,CAAC,EAAI,IAAI,CAACnC,KAAK,CAACE,YAAY,CAAE,CAC9D,IAAI,CAACkB,cAAc,EAAE,CACvB,CACF,CACF,CAAC,sBAgED,iBAAS,iBACP,mBACE,MAAC,OAAO,EACN,SAAS,CAAE,IAAI,CAACT,KAAK,CAACyB,SAAU,CAChC,QAAQ,MACR,KAAK,CAAE,CACLC,OAAO,CAAE,IAAI,CAAC1B,KAAK,CAAC2B,IAAI,CAAG,MAAM,CAAG,MAAM,CAC1CC,aAAa,CAAE,QAAQ,CACvBC,QAAQ,CAAE,GAAG,CACbC,SAAS,CAAE,CAAC,CACZC,SAAS,CAAE,CAAC,CACZC,YAAY,CAAE,CAChB,CAAE,wBAEF,aACE,SAAS,CAAC,eAAe,CACzB,GAAG,CAAE,IAAI,CAACxC,WAAY,CACtB,KAAK,CAAE,CAAEyC,QAAQ,CAAE,UAAW,CAAE,wBAEhC,KAAC,OAAO,CAAC,KAAK,WACX,IAAI,CAACjC,KAAK,CAACkC,IAAI,CAACC,GAAG,CAAC,SAACvB,GAAG,qBACvB,KAAC,WAAW,gCAENA,GAAG,MACP,UAAU,CAAE,MAAI,CAACZ,KAAK,CAACoC,UAAW,CAClC,OAAO,CAAE,MAAI,CAACpC,KAAK,CAACqB,OAAQ,CAC5B,aAAa,CAAE,MAAI,CAACX,aAAc,GAJ7BE,GAAG,CAACyB,SAAS,CAAGzB,GAAG,CAACK,EAAE,CAK3B,EACH,CAAC,EAEY,CACf,CAAC,IAAI,CAAC5B,KAAK,CAACE,YAAY,eACvB,KAAC,MAAM,EACL,IAAI,CAAC,MAAM,CACX,OAAO,CAAE,IAAI,CAACkB,cAAe,CAC7B,KAAK,CAAE,CACLwB,QAAQ,CAAE,QAAQ,CAClBK,MAAM,CAAE,CAAC,CACTZ,OAAO,CAAE,OAAO,CAChBa,MAAM,CAAE,QACV,CAAE,UACH,gBAED,EACD,GACG,cACN,KAAC,KAAK,EACJ,QAAQ,MACR,KAAK,MACL,UAAU,CAAE,oBAAC5C,CAAM,QAAKA,EAAC,CAAC6C,GAAG,GAAK,OAAO,EAAI,MAAI,CAACzC,WAAW,EAAE,EAAC,CAChE,QAAQ,CAAE,IAAI,CAACL,aAAc,CAC7B,KAAK,CAAE,IAAI,CAACL,KAAK,CAACC,OAAQ,CAC1B,IAAI,cACF,KAAC,IAAI,EACH,OAAO,CAAE,IAAI,CAACS,WAAY,CAC1B,IAAI,CAAC,MAAM,CACX,QAAQ,MACR,QAAQ,MACR,IAAI,OAEP,CACD,WAAW,CAAC,oBAAoB,EAChC,GACM,CAEd,CAAC,kBAhJuBpB,KAAK,CAAC8D,SAAS,EAmJzC,GAAMC,YAAW,CAAG,QAAdA,YAAW,MASN,IARTzB,GAAE,MAAFA,EAAE,CACF0B,OAAO,MAAPA,OAAO,CACPN,SAAS,MAATA,SAAS,CACT1B,GAAG,MAAHA,GAAG,CACHC,GAAG,MAAHA,GAAG,CACHS,OAAO,MAAPA,OAAO,CACPe,UAAU,MAAVA,UAAU,CACV1B,aAAa,MAAbA,aAAa,CAEb,mBACE,MAAC,OAAO,yBACN,KAAC,OAAO,CAAC,MAAM,EACb,GAAG,CAAE0B,UAAU,CAACnB,EAAE,CAAC,EAAI9B,iBAAiB,CAACkC,OAAO,CAACJ,EAAE,CAAC,CAAE/B,WAAW,CAAC+B,EAAE,CAAC,CAAE,EACvE,cACF,MAAC,OAAO,CAAC,OAAO,yBACd,KAAC,OAAO,CAAC,MAAM,EAAC,EAAE,CAAC,GAAG,CAAC,SAAS,CAAC,OAAO,UACrCI,OAAO,CAACJ,EAAE,CAAC,EAAIA,EAAE,EACH,cACjB,KAAC,OAAO,CAAC,QAAQ,EAAC,SAAS,CAAC,MAAM,uBAChC,qBAAM,GAAI2B,KAAI,CAACP,SAAS,CAAC,CAACQ,kBAAkB,EAAE,EAAO,EACpC,cACnB,KAAC,OAAO,CAAC,IAAI,EAAC,SAAS,CAAC,cAAc,UACnClC,GAAG,EAAID,aAAa,CAACC,GAAG,CAAEC,GAAG,CAAC,EAClB,cACf,KAAC,OAAO,CAAC,IAAI,EAAC,SAAS,CAAC,OAAO,UAAE,CAACD,GAAG,EAAIC,GAAG,EAAgB,GAC5C,GACV,CAEd,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}